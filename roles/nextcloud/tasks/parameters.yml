---

- name: Set value
  block:
    - name: List value
      ansible.builtin.command:
        cmd: php occ config:app:get {{ item.section }} {{ item.name }} --output yaml
        chdir: "{{ nextcloud_destination }}/nextcloud"
      register: nextcloud_list_value
      changed_when: no
      become: yes
      become_user: "{{ nextcloud_httpd_owner }}"
      failed_when:
        - nextcloud_list_value.stdout | from_yaml != item.value
  rescue:
    - name: Set nextcloud parameter
      ansible.builtin.command:
        cmd: php occ config:app:set {{ item.section }} {{ item.name }} --value {{ item.value }}
        chdir: "{{ nextcloud_destination }}/nextcloud"
      changed_when: no
      become: yes
      become_user: "{{ nextcloud_httpd_owner }}"
      notify:
        - Set permissions
